<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic API - Template Manager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: #fff; padding: 30px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 10px; }
        .subtitle { color: #666; }
        .main-content { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        .sidebar { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); height: fit-content; }
        .content { background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .template-list { list-style: none; }
        .template-item { padding: 10px; margin: 5px 0; border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .template-item:hover { background: #f0f0f0; }
        .template-item.active { background: #e3f2fd; }
        textarea { width: 100%; min-height: 400px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 14px; }
        .actions { margin-top: 20px; display: flex; gap: 10px; }
        .docs { margin-top: 30px; padding-top: 30px; border-top: 2px solid #eee; }
        .docs h3 { margin: 20px 0 10px; color: #333; }
        .docs code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-size: 13px; }
        .docs pre { background: #f4f4f4; padding: 15px; border-radius: 4px; overflow-x: auto; margin: 10px 0; }
        .new-template { margin-bottom: 15px; }
        .new-template input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ Semantic API</h1>
            <p class="subtitle">Template-based Intent-driven API with Kiro CLI Integration</p>
        </header>

        <div class="main-content">
            <div class="sidebar">
                <h2 style="margin-bottom: 15px;">Templates</h2>
                <div class="new-template">
                    <input type="text" id="newTemplateName" placeholder="GET-example or POST-users">
                    <button class="btn btn-success" onclick="createTemplate()">+ New Template</button>
                </div>
                <ul class="template-list" id="templateList"></ul>
            </div>

            <div class="content">
                <div id="editorSection" style="display: none;">
                    <h2 id="templateTitle">Template Editor</h2>
                    <textarea id="templateEditor"></textarea>
                    <div class="actions">
                        <button class="btn btn-primary" onclick="saveTemplate()">Save</button>
                        <button class="btn btn-danger" onclick="deleteTemplate()">Delete</button>
                        <button class="btn" onclick="testTemplate()">Test</button>
                    </div>
                </div>

                <div class="docs">
                    <h2>ğŸ“– ì‚¬ìš© ì„¤ëª…ì„œ</h2>
                    
                    <h3>1. ê°œìš”</h3>
                    <p>Semantic APIëŠ” URL ê²½ë¡œë¥¼ ë§ˆí¬ë‹¤ìš´ í…œí”Œë¦¿ íŒŒì¼ë¡œ ë§¤í•‘í•˜ì—¬ Kiro CLIê°€ ì‹¤í–‰í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.</p>
                    
                    <h3>2. í…œí”Œë¦¿ ìƒì„±</h3>
                    <p>í…œí”Œë¦¿ ì´ë¦„ í˜•ì‹: <code>METHOD-path.md</code></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><code>GET-weather.md</code> â†’ <code>GET /weather</code></li>
                        <li><code>POST-users.md</code> â†’ <code>POST /users</code></li>
                        <li><code>GET-aipm-stories.md</code> â†’ <code>GET /aipm-stories</code></li>
                    </ul>

                    <h3>3. í…œí”Œë¦¿ êµ¬ì¡°</h3>
                    <pre>## ROLE ASSIGNMENT
**YOU ARE**: A data fetcher
**YOUR RESPONSIBILITY**: Execute instructions exactly

## Technical Specifications

**STEP 1**: Get data
\`\`\`bash
DATA=$(aws dynamodb get-item --table-name my-table --key '{"id":{"N":"{{id}}"}}')
\`\`\`

**STEP 2**: Send to callback
\`\`\`bash
curl -X POST http://100.28.131.76:8082/callback/{{taskId}} \\
  -H "Content-Type: application/json" \\
  -d "$DATA"
\`\`\`</pre>

                    <h3>4. íŒŒë¼ë¯¸í„° ì¹˜í™˜</h3>
                    <p>URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ëŠ” ìë™ìœ¼ë¡œ í…œí”Œë¦¿ì˜ <code>{{ë³€ìˆ˜ëª…}}</code>ìœ¼ë¡œ ì¹˜í™˜ë©ë‹ˆë‹¤.</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><code>GET /weather?city=Seoul</code> â†’ <code>{{city}}</code> = Seoul</li>
                        <li><code>GET /stories?id=512</code> â†’ <code>{{id}}</code> = 512</li>
                        <li><code>{{taskId}}</code>ëŠ” ìë™ ìƒì„±ë©ë‹ˆë‹¤</li>
                    </ul>

                    <h3>5. API í˜¸ì¶œ ì˜ˆì‹œ</h3>
                    <pre>curl "http://100.28.131.76:8082/weather?city=Seoul"
curl "http://100.28.131.76:8082/aipm-stories?id=512"</pre>

                    <h3>6. ì‘ë‹µ ì‹œê°„</h3>
                    <p>í‰ê·  ì‘ë‹µ ì‹œê°„: 5-10ì´ˆ (Worker í´ë§ 0.5ì´ˆ + Kiro ì‹¤í–‰ 2ì´ˆ + ëª…ë ¹ ì‹¤í–‰ 2-5ì´ˆ)</p>

                    <h3>7. ì£¼ì˜ì‚¬í•­</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>í…œí”Œë¦¿ì€ ë°˜ë“œì‹œ callback curl ëª…ë ¹ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤</li>
                        <li>Kiro CLIëŠ” ëª…ë ¹ì„ ì •í™•íˆ ì‹¤í–‰í•˜ë„ë¡ ì§€ì‹œí•´ì•¼ í•©ë‹ˆë‹¤</li>
                        <li>íŒŒë¼ë¯¸í„° ì´ë¦„ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTemplate = null;
        const API_BASE = 'http://100.28.131.76:8082';

        async function loadTemplates() {
            try {
                const res = await fetch(`${API_BASE}/templates`);
                const data = await res.json();
                const list = document.getElementById('templateList');
                list.innerHTML = data.templates.map(t => `
                    <li class="template-item" data-name="${t}" onclick="selectTemplate('${t}')">
                        <span>${t}</span>
                    </li>
                `).join('');
            } catch (e) {
                alert('í…œí”Œë¦¿ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        async function selectTemplate(name) {
            try {
                const res = await fetch(`${API_BASE}/template/${name}`);
                const data = await res.text();
                currentTemplate = name;
                document.getElementById('templateTitle').textContent = name;
                document.getElementById('templateEditor').value = data;
                document.getElementById('editorSection').style.display = 'block';
                
                document.querySelectorAll('.template-item').forEach(el => el.classList.remove('active'));
                const clickedItem = document.querySelector(`.template-item[data-name="${name}"]`);
                if (clickedItem) clickedItem.classList.add('active');
            } catch (e) {
                alert('í…œí”Œë¦¿ ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        async function createTemplate() {
            const name = document.getElementById('newTemplateName').value.trim();
            if (!name) return alert('í…œí”Œë¦¿ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
            if (!name.match(/^(GET|POST|PUT|DELETE|PATCH)-[\w-]+$/)) {
                return alert('í˜•ì‹: METHOD-path (ì˜ˆ: GET-weather, POST-users)');
            }
            
            const template = `# ${name} Template

## ROLE ASSIGNMENT
**YOU ARE**: A task executor
**YOUR RESPONSIBILITY**: Execute instructions exactly

## Technical Specifications

**STEP 1**: Execute your command
\`\`\`bash
RESULT=$(echo "Hello from ${name}")
\`\`\`

**STEP 2**: Send to callback
\`\`\`bash
curl -X POST http://100.28.131.76:8082/callback/{{taskId}} \\
  -H "Content-Type: application/json" \\
  -d "{\\"message\\": \\"$RESULT\\"}"
\`\`\``;

            try {
                const res = await fetch(`${API_BASE}/template/${name}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'text/plain' },
                    body: template
                });
                if (res.ok) {
                    document.getElementById('newTemplateName').value = '';
                    await loadTemplates();
                    selectTemplate(name);
                } else {
                    alert('í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨');
                }
            } catch (e) {
                alert('í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨: ' + e.message);
            }
        }

        async function saveTemplate() {
            if (!currentTemplate) return;
            const content = document.getElementById('templateEditor').value;
            try {
                const res = await fetch(`${API_BASE}/template/${currentTemplate}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'text/plain' },
                    body: content
                });
                if (res.ok) {
                    alert('ì €ì¥ ì™„ë£Œ');
                } else {
                    alert('ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (e) {
                alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
            }
        }

        async function deleteTemplate() {
            if (!currentTemplate) return;
            if (!confirm(`${currentTemplate}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const res = await fetch(`${API_BASE}/template/${currentTemplate}`, {
                    method: 'DELETE'
                });
                if (res.ok) {
                    document.getElementById('editorSection').style.display = 'none';
                    currentTemplate = null;
                    await loadTemplates();
                } else {
                    alert('ì‚­ì œ ì‹¤íŒ¨');
                }
            } catch (e) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        function testTemplate() {
            if (!currentTemplate) return;
            const [method, path] = currentTemplate.replace('.md', '').split('-');
            const params = prompt('ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì…ë ¥ (ì˜ˆ: city=Seoul, id=512)');
            const url = params ? `${API_BASE}/${path}?${params}` : `${API_BASE}/${path}`;
            window.open(url, '_blank');
        }

        loadTemplates();
    </script>
</body>
</html>
